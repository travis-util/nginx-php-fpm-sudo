language: php
sudo: true

env:
- PS_FORMAT=user,pid,ppid,nlwp,%mem,args

before_install:
- sudo aptitude update -Z
- sudo aptitude install nginx -Z --assume-yes
- sudo aptitude install colordiff -Z --assume-yes


script:
- service nginx status
- w3m -dump http://localhost:80
- curl --connect-timeout 1 http://localhost | w3m -dump -T text/html
- curl http://icanhazip.com
- ping -c 1 $(curl http://icanhazip.com)
- curl --connect-timeout 1 http://$(curl http://icanhazip.com) | w3m -dump -T text/html
- ping -c 1 $(ip addr show eth0 | grep inet | awk '{ print $2; }' | sed 's/\/.*$//' | head --lines=1)


after_script:
- man nginx
- dpkg --listfiles nginx
- dpkg --listfiles nginx-common
- dpkg --listfiles nginx-core
- ls --color --recursive /etc/nginx
- cat /etc/nginx/nginx.conf
- cat /etc/nginx/sites-available/default
- grep 'server_name.*;$' /etc/nginx/sites-available/*
- cat .nginx-default
- grep 'server_name.*;$' /etc/nginx/sites-available/* .nginx-default
- grep 'server_name.*;$' .nginx-default
- colordiff --minimal --side-by-side /etc/nginx/sites-available/default .nginx-default
- sudo cp --force .nginx-default /etc/nginx/sites-available/default
- cat /etc/default/nginx
- ls --color /usr/share/nginx/html
- w3m -dump /usr/share/nginx/html/index.html
- w3m -dump /usr/share/nginx/html/50x.html
- ps -C nginx
- ls -A --color /var/www

- ls --color /var/run
- grep cgi.fix_pathinfo /etc/php5/fpm/php.ini #####################################3
- php-fpm --version
- php --ini
- php-fpm -h
- php-fpm -i
- ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm -i
- command -v php-fpm
- ls $(command -v php-fpm) --color
- ls $(command -v php-fpm) --color --dereference
- ls ~/.phpenv/versions --color
- ls ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- cat ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- grep '^listen' ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- grep 'error_log' ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- grep '^pm = ' ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- grep '^pm.max_children' ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
- find ~/.phpenv/versions -name php.ini
- find ~/.phpenv/versions/$(phpenv version-name) -name php.ini
- man php-fpm
- php-fpm --fpm-config ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
# - sudo ~/.phpenv/versions/$(phpenv version-name)/sbin/php-fpm --fpm-config ~/.phpenv/versions/$(phpenv version-name)/etc/php-fpm.conf.default
#^ ERROR: [pool www] cannot get gid for group 'nobody'
# sudo: php-fpm: command not found
- ls --color /var/run
- ls --color log
- ls --color log/php-fpm.log
- ls --color /log
- ls --color /log/php-fpm.log
- ps -C php-fpm
# - find / -name php5-fpm.sock

- sudo service nginx restart
- ps -C nginx
- sudo cp info.php /usr/share/nginx/html
- w3m -dump http://localhost:80/info.php
